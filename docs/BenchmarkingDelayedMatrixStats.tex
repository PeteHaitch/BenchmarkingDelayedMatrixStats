\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Benchmarking the DelayedMatrixStats package},
            pdfauthor={Peter Hickey},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Benchmarking the DelayedMatrixStats package}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Peter Hickey}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2017-06-09}

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\chapter{Introduction}\label{introduction}

The
\emph{\href{http://bioconductor.org/packages/DelayedArray}{DelayedArray}}
package defines the \emph{DelayedMatrix} class, for wrapping matrix-like
objects to provide a unified interface.

\begin{quote}
Wrapping an matrix-like object (typically an on-disk object) in a
DelayedMatrix object allows one to perform common matrix operations on
it without loading the object in memory. In order to reduce memory usage
and optimize performance, operations on the object are either delayed or
executed using a block processing mechanism (see
\texttt{?DelayedArray::DelayedMatrix} for further details)
\end{quote}

A big advantage of this is we can use choose different matrix
``\emph{backends}'' for storing the data while preserving a common
interface. Examples of backends and data they are tailored towards using
are given below:

\begin{longtable}[]{@{}llll@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Class\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright\strut
Package\strut
\end{minipage} & \begin{minipage}[b]{0.25\columnwidth}\raggedright\strut
Type of data\strut
\end{minipage} & \begin{minipage}[b]{0.25\columnwidth}\raggedright\strut
Example\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{matrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{base}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Dense matrix\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
RNA-seq counts matrix\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{dgCMatrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{https://CRAN.R-project.org/package=Matrix}{Matrix}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Sparse data\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Single-cell RNA-seq counts matrix\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{HDF5Matrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{http://bioconductor.org/packages/HDF5Array}{HDF5Array}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Dense matrix too large for memory\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Non-CpG methylation\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{RleArray}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{http://bioconductor.org/packages/DelayedArray}{DelayedArray}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Data with runs of identical values\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Sequencing coverage\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\section{Session info}\label{session-info}

The R session information when compiling this book is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{session_info}\NormalTok{()}
\CommentTok{#>  setting  value                       }
\CommentTok{#>  version  R version 3.4.0 (2017-04-21)}
\CommentTok{#>  system   x86_64, darwin15.6.0        }
\CommentTok{#>  ui       X11                         }
\CommentTok{#>  language (EN)                        }
\CommentTok{#>  collate  en_AU.UTF-8                 }
\CommentTok{#>  tz       America/New_York            }
\CommentTok{#>  date     2017-06-09                  }
\CommentTok{#> }
\CommentTok{#>  package            * version    date      }
\CommentTok{#>  backports            1.1.0      2017-05-22}
\CommentTok{#>  base               * 3.4.0      2017-04-21}
\CommentTok{#>  BiocGenerics       * 0.23.0     2017-04-27}
\CommentTok{#>  BiocStyle            2.5.1      2017-05-27}
\CommentTok{#>  bookdown             0.4        2017-06-04}
\CommentTok{#>  colorspace           1.3-2      2016-12-14}
\CommentTok{#>  compiler             3.4.0      2017-04-21}
\CommentTok{#>  datasets           * 3.4.0      2017-04-21}
\CommentTok{#>  DelayedArray       * 0.3.9      2017-06-03}
\CommentTok{#>  DelayedMatrixStats * 0.0.0.9000 2017-06-09}
\CommentTok{#>  devtools             1.13.2     2017-06-02}
\CommentTok{#>  digest               0.6.12     2017-01-27}
\CommentTok{#>  evaluate             0.10       2016-10-11}
\CommentTok{#>  fortunes             1.5-4      2016-12-29}
\CommentTok{#>  ggplot2              2.2.1      2016-12-30}
\CommentTok{#>  graphics           * 3.4.0      2017-04-21}
\CommentTok{#>  grDevices          * 3.4.0      2017-04-21}
\CommentTok{#>  grid                 3.4.0      2017-04-21}
\CommentTok{#>  gtable               0.2.0      2016-02-26}
\CommentTok{#>  HDF5Array          * 1.5.8      2017-05-29}
\CommentTok{#>  htmltools            0.3.6      2017-04-28}
\CommentTok{#>  IRanges            * 2.11.3     2017-05-20}
\CommentTok{#>  knitr                1.16       2017-05-18}
\CommentTok{#>  lattice              0.20-35    2017-03-25}
\CommentTok{#>  lazyeval             0.2.0      2016-06-12}
\CommentTok{#>  magrittr             1.5        2014-11-22}
\CommentTok{#>  Matrix             * 1.2-10     2017-04-28}
\CommentTok{#>  matrixStats        * 0.52.2     2017-04-14}
\CommentTok{#>  memoise              1.1.0      2017-05-26}
\CommentTok{#>  methods            * 3.4.0      2017-04-21}
\CommentTok{#>  microbenchmark     * 1.4-2.1    2015-11-25}
\CommentTok{#>  munsell              0.4.3      2016-02-13}
\CommentTok{#>  parallel           * 3.4.0      2017-04-21}
\CommentTok{#>  plyr                 1.8.4      2016-06-08}
\CommentTok{#>  profmem            * 0.4.0      2016-09-15}
\CommentTok{#>  Rcpp                 0.12.11    2017-05-22}
\CommentTok{#>  rhdf5              * 2.21.1     2017-05-11}
\CommentTok{#>  rlang                0.1.1.9000 2017-05-26}
\CommentTok{#>  rmarkdown            1.5        2017-04-26}
\CommentTok{#>  rprojroot            1.2        2017-01-16}
\CommentTok{#>  rstudioapi           0.6        2016-06-27}
\CommentTok{#>  S4Vectors          * 0.15.3     2017-06-03}
\CommentTok{#>  scales               0.4.1      2016-11-09}
\CommentTok{#>  stats              * 3.4.0      2017-04-21}
\CommentTok{#>  stats4             * 3.4.0      2017-04-21}
\CommentTok{#>  stringi              1.1.5      2017-04-07}
\CommentTok{#>  stringr              1.2.0      2017-02-18}
\CommentTok{#>  tibble               1.3.3      2017-05-28}
\CommentTok{#>  tools                3.4.0      2017-04-21}
\CommentTok{#>  utils              * 3.4.0      2017-04-21}
\CommentTok{#>  withr                1.0.2      2016-06-20}
\CommentTok{#>  yaml                 2.1.14     2016-11-12}
\CommentTok{#>  zlibbioc             1.23.0     2017-04-27}
\CommentTok{#>  source                           }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  Github (rstudio/bookdown@fdd68e4)}
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Github (hadley/memoise@e372cde)  }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  cran (@2.21.1)                   }
\CommentTok{#>  Github (hadley/rlang@c351186)    }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  cran (@1.3.3)                    }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor}
\end{Highlighting}
\end{Shaded}

\chapter{Test data}\label{test_data}

We will benchmark the
\emph{\href{https://github.com/PeteHaitch/DelayedMatrixStats}{DelayedMatrixStats}}
package using different types of matrix-like data:

\begin{itemize}
\tightlist
\item
  \texttt{dense\_matrix}: A dense \emph{matrix} with 600 columns and
  20000 rows (91.6 Mb)
\item
  \texttt{sparse\_matrix}: A sparse \emph{dgcMatrix} with 600 columns
  and 20000 rows where 60\% of entries are zero (54.9 Mb)
\item
  \texttt{rle\_matrix}: An run-length encoded column \emph{RleMatrix}
  with 6 columns and 2000000 rows (0.5 Mb)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(DelayedMatrixStats)}
\KeywordTok{library}\NormalTok{(Matrix)}
\KeywordTok{library}\NormalTok{(HDF5Array)}

\CommentTok{# Dense matrix}
\NormalTok{dense_matrix <-}\StringTok{ }\KeywordTok{DelayedArray}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{runif}\NormalTok{(}\DecValTok{20000} \OperatorTok{*}\StringTok{ }\DecValTok{600}\NormalTok{), }\DataTypeTok{nrow =} \DecValTok{20000}\NormalTok{,}
                                  \DataTypeTok{ncol =} \DecValTok{600}\NormalTok{))}
\NormalTok{dense_matrix}
\CommentTok{#> DelayedMatrix object of 20000 x 600 doubles:}
\CommentTok{#>                 [,1]        [,2]        [,3] ...     [,599]     [,600]}
\CommentTok{#>     [1,] 0.291123149 0.746567243 0.714732255   . 0.75857413 0.64889705}
\CommentTok{#>     [2,] 0.695032771 0.835652019 0.994773283   . 0.57136535 0.59089245}
\CommentTok{#>     [3,] 0.376537710 0.076370680 0.631883153   . 0.08632942 0.64604683}
\CommentTok{#>     [4,] 0.099155580 0.983260972 0.033870884   . 0.17194848 0.78613336}
\CommentTok{#>     [5,] 0.223655179 0.003016347 0.184510716   . 0.32769976 0.98399021}
\CommentTok{#>      ...           .           .           .   .          .          .}
\CommentTok{#> [19996,]  0.19562940  0.64344791  0.34820057   .  0.2382142  0.5758769}
\CommentTok{#> [19997,]  0.50863128  0.38698444  0.34155233   .  0.5391943  0.2431121}
\CommentTok{#> [19998,]  0.85569166  0.31043662  0.78594727   .  0.7177261  0.8931934}
\CommentTok{#> [19999,]  0.90838796  0.04155858  0.36675316   .  0.5686322  0.3579163}
\CommentTok{#> [20000,]  0.21878846  0.74873281  0.99661168   .  0.7821497  0.5828003}

\CommentTok{# 60% zero elements}
\NormalTok{sparse_matrix <-}\StringTok{ }\KeywordTok{seed}\NormalTok{(dense_matrix)}
\NormalTok{zero_idx <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{length}\NormalTok{(sparse_matrix), }\FloatTok{0.6} \OperatorTok{*}\StringTok{ }\KeywordTok{length}\NormalTok{(sparse_matrix))}
\NormalTok{sparse_matrix[zero_idx] <-}\StringTok{ }\DecValTok{0}
\NormalTok{sparse_matrix <-}\StringTok{ }\KeywordTok{DelayedArray}\NormalTok{(Matrix}\OperatorTok{::}\KeywordTok{Matrix}\NormalTok{(sparse_matrix, }\DataTypeTok{sparse =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{sparse_matrix}
\CommentTok{#> DelayedMatrix object of 20000 x 600 doubles:}
\CommentTok{#>                 [,1]        [,2]        [,3] ...    [,599]    [,600]}
\CommentTok{#>     [1,] 0.000000000 0.000000000 0.000000000   . 0.7585741 0.6488971}
\CommentTok{#>     [2,] 0.695032771 0.835652019 0.000000000   . 0.0000000 0.0000000}
\CommentTok{#>     [3,] 0.376537710 0.076370680 0.631883153   . 0.0000000 0.6460468}
\CommentTok{#>     [4,] 0.099155580 0.983260972 0.000000000   . 0.0000000 0.0000000}
\CommentTok{#>     [5,] 0.223655179 0.003016347 0.000000000   . 0.0000000 0.0000000}
\CommentTok{#>      ...           .           .           .   .         .         .}
\CommentTok{#> [19996,]  0.19562940  0.64344791  0.00000000   . 0.0000000 0.0000000}
\CommentTok{#> [19997,]  0.00000000  0.00000000  0.34155233   . 0.0000000 0.2431121}
\CommentTok{#> [19998,]  0.00000000  0.31043662  0.00000000   . 0.7177261 0.8931934}
\CommentTok{#> [19999,]  0.00000000  0.04155858  0.36675316   . 0.5686322 0.0000000}
\CommentTok{#> [20000,]  0.00000000  0.00000000  0.99661168   . 0.0000000 0.5828003}

\CommentTok{# HDF5-backed dense matrix}
\CommentTok{# hdf5_matrix <- as(dense_matrix, "HDF5Array")}

\CommentTok{# Run-length encoded column matrix}
\NormalTok{rle_matrix <-}\StringTok{ }\KeywordTok{RleArray}\NormalTok{(}\KeywordTok{Rle}\NormalTok{(}\KeywordTok{sample}\NormalTok{(2L, }\DecValTok{200000} \OperatorTok{*}\StringTok{ }\DecValTok{6} \OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{, }\DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{), }\DecValTok{100}\NormalTok{),}
                       \DataTypeTok{dim =} \KeywordTok{c}\NormalTok{(}\DecValTok{2000000}\NormalTok{, }\DecValTok{6}\NormalTok{))}
\NormalTok{rle_matrix}
\CommentTok{#> RleMatrix object of 2000000 x 6 integers:}
\CommentTok{#>            [,1] [,2] [,3] [,4] [,5] [,6]}
\CommentTok{#>       [1,]    2    2    2    2    1    1}
\CommentTok{#>       [2,]    2    2    2    2    1    1}
\CommentTok{#>       [3,]    2    2    2    2    1    1}
\CommentTok{#>       [4,]    2    2    2    2    1    1}
\CommentTok{#>       [5,]    2    2    2    2    1    1}
\CommentTok{#>        ...    .    .    .    .    .    .}
\CommentTok{#> [1999996,]    1    2    1    2    2    2}
\CommentTok{#> [1999997,]    1    2    1    2    2    2}
\CommentTok{#> [1999998,]    1    2    1    2    2    2}
\CommentTok{#> [1999999,]    1    2    1    2    2    2}
\CommentTok{#> [2000000,]    1    2    1    2    2    2}
\end{Highlighting}
\end{Shaded}

Obviously, this is not a comprehensive set of inputs. Rather, it chosen
to be somewhat representative of some typical genomics data.

\section{Measuring performance}\label{measuring-performance}

Timings are measured using the
\emph{\href{https://CRAN.R-project.org/package=microbenchmark}{microbenchmark}}
package using 10 repetitions (\texttt{times}). Memory allocations are
reported using the
\emph{\href{https://CRAN.R-project.org/package=profmem}{profmem}}
package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(microbenchmark)}
\KeywordTok{library}\NormalTok{(profmem)}
\NormalTok{times <-}\StringTok{ }\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\chapter{\texorpdfstring{\texttt{colSums2()}}{colSums2()}}\label{colsums2}

We compare the \texttt{DelayedArray::colSums()} method, which uses the
block-processing algorithm, to the
\texttt{DelayedMatrixStats::colSums2()} method, which uses tailored
algorithms depending on the \emph{seed} of the \emph{DelayedMatrix}, as
well as comparing to the \texttt{colSums2()} method that acts directly
on the seed of the \emph{DelayedMatrix} object\footnote{The `seed
  method' shouldn't be called by the user because it does not realise
  delayed operations. It is used here for demonstration purposes on a
  ``\emph{pristine}'' DelayedMatrix to measure the additional overhead
  of S4 methods}

\section{\texorpdfstring{Pristine
\emph{DelayedMatrix}}{Pristine DelayedMatrix}}\label{pristine-delayedmatrix}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(dense_matrix)),}
\NormalTok{               matrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(dense_matrix)),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                              expr        min         lq}
\CommentTok{#>               DelayedArray::colSums(dense_matrix) 1283.48911 1864.31577}
\CommentTok{#>        DelayedMatrixStats::colSums2(dense_matrix)   17.29489   21.24989}
\CommentTok{#>  DelayedMatrixStats::colSums2(seed(dense_matrix))   13.60255   17.87302}
\CommentTok{#>         matrixStats::colSums2(seed(dense_matrix))   12.99146   15.80239}
\CommentTok{#>        mean     median         uq        max neval}
\CommentTok{#>  2004.46189 2048.45751 2301.36485 2521.58140    10}
\CommentTok{#>    38.08371   36.05451   47.70144   73.72097    10}
\CommentTok{#>    25.94223   24.00078   30.68420   41.72278    10}
\CommentTok{#>    21.81281   17.31656   28.85252   33.48672    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix)))}
\CommentTok{#> [1] 2498171088}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix)))}
\CommentTok{#> [1] 165512}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(sparse_matrix)),}
\NormalTok{               Matrix}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(}\KeywordTok{seed}\NormalTok{(sparse_matrix)), }
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                               expr         min         lq}
\CommentTok{#>               DelayedArray::colSums(sparse_matrix) 1264.530744 1316.15718}
\CommentTok{#>        DelayedMatrixStats::colSums2(sparse_matrix)   11.817381   13.42313}
\CommentTok{#>  DelayedMatrixStats::colSums2(seed(sparse_matrix))   10.175122   11.20796}
\CommentTok{#>               Matrix::colSums(seed(sparse_matrix))    9.694093   11.23716}
\CommentTok{#>        mean     median         uq        max neval}
\CommentTok{#>  1452.48860 1386.43823 1524.39434 1853.55755    10}
\CommentTok{#>    14.41638   13.99009   15.73583   17.47814    10}
\CommentTok{#>    13.53717   12.41742   14.05605   21.09214    10}
\CommentTok{#>    11.71826   11.74576   12.26451   13.80694    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix)))}
\CommentTok{#> [1] 1709267496}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix)))}
\CommentTok{#> [1] 5464}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(rle_matrix)), }
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                            expr         min          lq}
\CommentTok{#>               DelayedArray::colSums(rle_matrix) 1310.023207 1355.152398}
\CommentTok{#>        DelayedMatrixStats::colSums2(rle_matrix)    4.044929    4.127730}
\CommentTok{#>  DelayedMatrixStats::colSums2(seed(rle_matrix))    2.654707    2.824271}
\CommentTok{#>         mean      median          uq         max neval}
\CommentTok{#>  1406.699029 1417.552379 1430.568801 1561.240497    10}
\CommentTok{#>     6.835946    4.509377    8.610080   15.512422    10}
\CommentTok{#>     3.166907    3.067424    3.324333    4.297344    10}

\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix)))}
\CommentTok{#> [1] 594934472}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix)))}
\CommentTok{#> [1] 1872}
\end{Highlighting}
\end{Shaded}

\section{With row subsetting}\label{with-row-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dense_matrix), }\KeywordTok{nrow}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                  expr       min        lq}
\CommentTok{#>              DelayedArray::colSums(dense_matrix[i, ]) 232.66977 269.30946}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, rows = i)  17.61365  17.94966}
\CommentTok{#>      mean    median        uq        max neval}
\CommentTok{#>  398.3456 322.16767 402.06056 1075.46715    10}
\CommentTok{#>   23.7913  23.64738  28.12027   31.48741    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, ])))}
\CommentTok{#> [1] 326614368}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 21512}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                   expr       min        lq}
\CommentTok{#>              DelayedArray::colSums(sparse_matrix[i, ]) 180.50731 216.85644}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, rows = i)  45.46621  51.43771}
\CommentTok{#>       mean    median        uq      max neval}
\CommentTok{#>  308.51542 254.18478 440.75724 513.4355    10}
\CommentTok{#>   72.10438  53.29957  70.54412 148.0876    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, ])))}
\CommentTok{#> [1] 217293464}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 5801656}

\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(rle_matrix), }\KeywordTok{nrow}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                expr       min        lq}
\CommentTok{#>              DelayedArray::colSums(rle_matrix[i, ])  134.5513  145.7055}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, rows = i) 2532.1597 2576.5126}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>   175.0424  152.0624  193.1471  315.7631    10}
\CommentTok{#>  2791.6364 2636.5898 2961.2963 3686.7874    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, ])))}
\CommentTok{#> [1] 62582200}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 99980704}
\end{Highlighting}
\end{Shaded}

\section{With column subsetting}\label{with-column-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(dense_matrix), }\KeywordTok{ncol}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                  expr        min}
\CommentTok{#>              DelayedArray::colSums(dense_matrix[, j]) 158.172784}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, cols = j)   3.507745}
\CommentTok{#>          lq      mean     median         uq        max neval}
\CommentTok{#>  160.532558 182.67404 163.364146 164.916947 314.841775    10}
\CommentTok{#>    3.833441   4.50892   4.257297   4.693838   6.984677    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[, j])))}
\CommentTok{#> [1] 326835928}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 161192}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                   expr      min       lq}
\CommentTok{#>              DelayedArray::colSums(sparse_matrix[, j]) 157.9222 183.6137}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, cols = j)  11.3190  13.4754}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>  213.04790 193.51740 216.82503 330.93421    10}
\CommentTok{#>   14.90289  15.52494  16.24069  17.78912    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[, j])))}
\CommentTok{#> [1] 217168584}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 5766944}

\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(rle_matrix), }\KeywordTok{ncol}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                expr       min         lq}
\CommentTok{#>              DelayedArray::colSums(rle_matrix[, j]) 674.01695 692.114868}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, cols = j)   3.81455   4.432296}
\CommentTok{#>        mean     median         uq        max neval}
\CommentTok{#>  737.488282 733.975966 766.304464 823.837522    10}
\CommentTok{#>    4.888522   4.565458   4.685504   8.740521    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[, j])))}
\CommentTok{#> [1] 305470160}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 1872}
\end{Highlighting}
\end{Shaded}

\section{With row and column
subsetting}\label{with-row-and-column-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dense_matrix), }\KeywordTok{nrow}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(dense_matrix), }\KeywordTok{ncol}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                            expr       min}
\CommentTok{#>                       DelayedArray::colSums(dense_matrix[i, j]) 36.368492}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, rows = i, cols = j)  2.998825}
\CommentTok{#>         lq      mean    median        uq       max neval}
\CommentTok{#>  39.064818 58.958453 64.690798 71.119834 85.491278    10}
\CommentTok{#>   3.029176  3.559399  3.125859  3.900654  5.987884    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                             expr      min}
\CommentTok{#>                       DelayedArray::colSums(sparse_matrix[i, j]) 46.43427}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, rows = i, cols = j) 43.84288}
\CommentTok{#>        lq     mean   median       uq       max neval}
\CommentTok{#>  58.80461 69.18963 64.13646 67.67738 131.87153    10}
\CommentTok{#>  45.14225 47.68512 47.19202 50.18447  52.70835    10}
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(rle_matrix), }\KeywordTok{nrow}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(rle_matrix), }\KeywordTok{ncol}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                          expr       min}
\CommentTok{#>                       DelayedArray::colSums(rle_matrix[i, j])   74.0634}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, rows = i, cols = j) 1258.5250}
\CommentTok{#>          lq      mean     median        uq       max neval}
\CommentTok{#>    80.39394  103.6879   96.71862  117.3074  153.2567    10}
\CommentTok{#>  1278.73703 1582.9624 1391.34098 1916.1114 2196.0357    10}
\end{Highlighting}
\end{Shaded}

\section{With delayed ops}\label{with-delayed-ops}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                          expr       min        lq}
\CommentTok{#>         DelayedArray::colSums(dense_matrix^2) 1807.3580 1965.1023}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix^2)  351.0731  404.5719}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>  2055.0077 2003.8251 2178.5791 2290.5040    10}
\CommentTok{#>   519.8276  507.9676  582.1483  864.0489    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                           expr      min       lq     mean}
\CommentTok{#>         DelayedArray::colSums(sparse_matrix^2) 1829.675 1922.903 2159.961}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix^2)  682.596  727.075  796.014}
\CommentTok{#>     median        uq       max neval}
\CommentTok{#>  2099.8463 2200.3313 2890.7803    10}
\CommentTok{#>   792.6587  851.5654  989.4052    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: seconds}
\CommentTok{#>                                        expr      min       lq     mean}
\CommentTok{#>         DelayedArray::colSums(rle_matrix^2) 1.621425 1.658672 1.735662}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix^2) 1.303282 1.369719 1.460526}
\CommentTok{#>    median       uq      max neval}
\CommentTok{#>  1.720114 1.768661 2.009433    10}
\CommentTok{#>  1.433386 1.553991 1.632721    10}
\end{Highlighting}
\end{Shaded}

\section{Summary}\label{summary}

\bibliography{packages.bib,book.bib}


\end{document}
