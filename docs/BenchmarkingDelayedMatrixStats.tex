\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Benchmarking the DelayedMatrixStats package},
            pdfauthor={Peter Hickey},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Benchmarking the DelayedMatrixStats package}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Peter Hickey}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2017-06-04}

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\chapter{Introduction}\label{introduction}

The
\emph{\href{http://bioconductor.org/packages/DelayedArray}{DelayedArray}}
package defines the \emph{DelayedMatrix} class, for wrapping matrix-like
objects to provide a unified interface.

\begin{quote}
Wrapping an matrix-like object (typically an on-disk object) in a
DelayedMatrix object allows one to perform common matrix operations on
it without loading the object in memory. In order to reduce memory usage
and optimize performance, operations on the object are either delayed or
executed using a block processing mechanism (see
\texttt{?DelayedArray::DelayedMatrix} for further details)
\end{quote}

A big advantage of this is we can use choose different matrix
``\emph{backends}'' for storing the data while preserving a common
interface. Examples of backends and data they are tailored towards using
are given below:

\begin{longtable}[]{@{}llll@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Class\strut
\end{minipage} & \begin{minipage}[b]{0.28\columnwidth}\raggedright\strut
Package\strut
\end{minipage} & \begin{minipage}[b]{0.25\columnwidth}\raggedright\strut
Type of data\strut
\end{minipage} & \begin{minipage}[b]{0.25\columnwidth}\raggedright\strut
Example\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{matrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{base}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Dense matrix\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
RNA-seq counts matrix\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{dgCMatrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{https://CRAN.R-project.org/package=Matrix}{Matrix}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Sparse data\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Single-cell RNA-seq counts matrix\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{HDF5Matrix}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{http://bioconductor.org/packages/HDF5Array}{HDF5Array}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Dense matrix too large for memory\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Non-CpG methylation\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\emph{RleArray}\strut
\end{minipage} & \begin{minipage}[t]{0.28\columnwidth}\raggedright\strut
\emph{\href{http://bioconductor.org/packages/DelayedArray}{DelayedArray}}\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Data with runs of identical values\strut
\end{minipage} & \begin{minipage}[t]{0.25\columnwidth}\raggedright\strut
Sequencing coverage\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\section{Session info}\label{session-info}

The R session information when compiling this book is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{session_info}\NormalTok{()}
\CommentTok{#>  setting  value                       }
\CommentTok{#>  version  R version 3.4.0 (2017-04-21)}
\CommentTok{#>  system   x86_64, darwin15.6.0        }
\CommentTok{#>  ui       X11                         }
\CommentTok{#>  language (EN)                        }
\CommentTok{#>  collate  en_AU.UTF-8                 }
\CommentTok{#>  tz       America/New_York            }
\CommentTok{#>  date     2017-06-04                  }
\CommentTok{#> }
\CommentTok{#>  package            * version    date      }
\CommentTok{#>  backports            1.1.0      2017-05-22}
\CommentTok{#>  base               * 3.4.0      2017-04-21}
\CommentTok{#>  BiocGenerics       * 0.23.0     2017-04-27}
\CommentTok{#>  BiocStyle            2.5.1      2017-05-27}
\CommentTok{#>  bookdown             0.4        2017-06-04}
\CommentTok{#>  colorspace           1.3-2      2016-12-14}
\CommentTok{#>  compiler             3.4.0      2017-04-21}
\CommentTok{#>  datasets           * 3.4.0      2017-04-21}
\CommentTok{#>  DelayedArray       * 0.3.8      2017-06-02}
\CommentTok{#>  DelayedMatrixStats * 0.0.0.9000 2017-05-28}
\CommentTok{#>  devtools             1.13.2     2017-06-02}
\CommentTok{#>  digest               0.6.12     2017-01-27}
\CommentTok{#>  evaluate             0.10       2016-10-11}
\CommentTok{#>  fortunes             1.5-4      2016-12-29}
\CommentTok{#>  ggplot2              2.2.1      2016-12-30}
\CommentTok{#>  graphics           * 3.4.0      2017-04-21}
\CommentTok{#>  grDevices          * 3.4.0      2017-04-21}
\CommentTok{#>  grid                 3.4.0      2017-04-21}
\CommentTok{#>  gtable               0.2.0      2016-02-26}
\CommentTok{#>  HDF5Array          * 1.5.8      2017-05-29}
\CommentTok{#>  htmltools            0.3.6      2017-04-28}
\CommentTok{#>  IRanges            * 2.11.3     2017-05-20}
\CommentTok{#>  knitr                1.16       2017-05-18}
\CommentTok{#>  lattice              0.20-35    2017-03-25}
\CommentTok{#>  lazyeval             0.2.0      2016-06-12}
\CommentTok{#>  magrittr             1.5        2014-11-22}
\CommentTok{#>  Matrix             * 1.2-10     2017-04-28}
\CommentTok{#>  matrixStats        * 0.52.2     2017-04-14}
\CommentTok{#>  memoise              1.1.0      2017-05-26}
\CommentTok{#>  methods            * 3.4.0      2017-04-21}
\CommentTok{#>  microbenchmark     * 1.4-2.1    2015-11-25}
\CommentTok{#>  munsell              0.4.3      2016-02-13}
\CommentTok{#>  parallel           * 3.4.0      2017-04-21}
\CommentTok{#>  plyr                 1.8.4      2016-06-08}
\CommentTok{#>  profmem            * 0.4.0      2016-09-15}
\CommentTok{#>  Rcpp                 0.12.11    2017-05-22}
\CommentTok{#>  rhdf5              * 2.21.1     2017-05-11}
\CommentTok{#>  rlang                0.1.1.9000 2017-05-26}
\CommentTok{#>  rmarkdown            1.5        2017-04-26}
\CommentTok{#>  rprojroot            1.2        2017-01-16}
\CommentTok{#>  rstudioapi           0.6        2016-06-27}
\CommentTok{#>  S4Vectors          * 0.15.2     2017-05-11}
\CommentTok{#>  scales               0.4.1      2016-11-09}
\CommentTok{#>  stats              * 3.4.0      2017-04-21}
\CommentTok{#>  stats4             * 3.4.0      2017-04-21}
\CommentTok{#>  stringi              1.1.5      2017-04-07}
\CommentTok{#>  stringr              1.2.0      2017-02-18}
\CommentTok{#>  tibble               1.3.3      2017-05-28}
\CommentTok{#>  tools                3.4.0      2017-04-21}
\CommentTok{#>  utils              * 3.4.0      2017-04-21}
\CommentTok{#>  withr                1.0.2      2016-06-20}
\CommentTok{#>  yaml                 2.1.14     2016-11-12}
\CommentTok{#>  zlibbioc             1.23.0     2017-04-27}
\CommentTok{#>  source                           }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  Github (rstudio/bookdown@fdd68e4)}
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor                     }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Github (hadley/memoise@e372cde)  }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  cran (@2.21.1)                   }
\CommentTok{#>  Github (hadley/rlang@c351186)    }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  cran (@0.15.2)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  cran (@1.3.3)                    }
\CommentTok{#>  local                            }
\CommentTok{#>  local                            }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  CRAN (R 3.4.0)                   }
\CommentTok{#>  Bioconductor}
\end{Highlighting}
\end{Shaded}

\chapter{Test data}\label{test_data}

We will benchmark the
\emph{\href{https://github.com/PeteHaitch/DelayedMatrixStats}{DelayedMatrixStats}}
package using different types of matrix-like data:

\begin{itemize}
\tightlist
\item
  \texttt{dense\_matrix}: A dense \emph{matrix} with 600 columns and
  20000 rows (91.6 Mb)
\item
  \texttt{sparse\_matrix}: A sparse \emph{dgcMatrix} with 600 columns
  and 20000 rows where 60\% of entries are zero (54.9 Mb)
\item
  \texttt{rle\_matrix}: An run-length encoded column \emph{RleMatrix}
  with 6 columns and 2000000 rows (0.5 Mb)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(DelayedMatrixStats)}
\KeywordTok{library}\NormalTok{(Matrix)}
\KeywordTok{library}\NormalTok{(HDF5Array)}

\CommentTok{# Dense matrix}
\NormalTok{dense_matrix <-}\StringTok{ }\KeywordTok{DelayedArray}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{runif}\NormalTok{(}\DecValTok{20000} \OperatorTok{*}\StringTok{ }\DecValTok{600}\NormalTok{), }\DataTypeTok{nrow =} \DecValTok{20000}\NormalTok{,}
                                  \DataTypeTok{ncol =} \DecValTok{600}\NormalTok{))}
\NormalTok{dense_matrix}
\CommentTok{#> DelayedMatrix object of 20000 x 600 doubles:}
\CommentTok{#>                [,1]       [,2]       [,3] ...     [,599]     [,600]}
\CommentTok{#>     [1,] 0.56211049 0.06052366 0.38033128   . 0.87799385 0.84693600}
\CommentTok{#>     [2,] 0.96372515 0.83906637 0.62496370   . 0.87406395 0.06190513}
\CommentTok{#>     [3,] 0.18319063 0.81058923 0.63978155   . 0.73985395 0.30726775}
\CommentTok{#>     [4,] 0.67745600 0.75232175 0.34283933   . 0.19136272 0.37044424}
\CommentTok{#>     [5,] 0.82650284 0.29491392 0.09360019   . 0.86290053 0.63351816}
\CommentTok{#>      ...          .          .          .   .          .          .}
\CommentTok{#> [19996,] 0.94517978 0.95109336 0.88648460   . 0.07201023 0.48243563}
\CommentTok{#> [19997,] 0.99308461 0.85953562 0.78748557   . 0.17937134 0.31886901}
\CommentTok{#> [19998,] 0.55040209 0.64421003 0.02668481   . 0.77054324 0.27607450}
\CommentTok{#> [19999,] 0.97592622 0.48989835 0.79181370   . 0.22407128 0.64161406}
\CommentTok{#> [20000,] 0.63496789 0.44949889 0.77485783   . 0.23457757 0.10117268}

\CommentTok{# 60% zero elements}
\NormalTok{sparse_matrix <-}\StringTok{ }\KeywordTok{seed}\NormalTok{(dense_matrix)}
\NormalTok{zero_idx <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{length}\NormalTok{(sparse_matrix), }\FloatTok{0.6} \OperatorTok{*}\StringTok{ }\KeywordTok{length}\NormalTok{(sparse_matrix))}
\NormalTok{sparse_matrix[zero_idx] <-}\StringTok{ }\DecValTok{0}
\NormalTok{sparse_matrix <-}\StringTok{ }\KeywordTok{DelayedArray}\NormalTok{(Matrix}\OperatorTok{::}\KeywordTok{Matrix}\NormalTok{(sparse_matrix, }\DataTypeTok{sparse =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{sparse_matrix}
\CommentTok{#> DelayedMatrix object of 20000 x 600 doubles:}
\CommentTok{#>                [,1]       [,2]       [,3] ...     [,599]     [,600]}
\CommentTok{#>     [1,] 0.00000000 0.06052366 0.00000000   .  0.0000000  0.0000000}
\CommentTok{#>     [2,] 0.00000000 0.83906637 0.62496370   .  0.0000000  0.0000000}
\CommentTok{#>     [3,] 0.18319063 0.81058923 0.63978155   .  0.7398540  0.0000000}
\CommentTok{#>     [4,] 0.67745600 0.00000000 0.34283933   .  0.1913627  0.3704442}
\CommentTok{#>     [5,] 0.00000000 0.29491392 0.00000000   .  0.8629005  0.0000000}
\CommentTok{#>      ...          .          .          .   .          .          .}
\CommentTok{#> [19996,]  0.9451798  0.0000000  0.0000000   . 0.07201023 0.00000000}
\CommentTok{#> [19997,]  0.0000000  0.0000000  0.0000000   . 0.00000000 0.00000000}
\CommentTok{#> [19998,]  0.5504021  0.0000000  0.0000000   . 0.00000000 0.27607450}
\CommentTok{#> [19999,]  0.0000000  0.0000000  0.0000000   . 0.22407128 0.64161406}
\CommentTok{#> [20000,]  0.6349679  0.0000000  0.0000000   . 0.00000000 0.00000000}

\CommentTok{# HDF5-backed dense matrix}
\CommentTok{# hdf5_matrix <- as(dense_matrix, "HDF5Array")}

\CommentTok{# Run-length encoded column matrix}
\NormalTok{rle_matrix <-}\StringTok{ }\KeywordTok{RleArray}\NormalTok{(}\KeywordTok{Rle}\NormalTok{(}\KeywordTok{sample}\NormalTok{(2L, }\DecValTok{200000} \OperatorTok{*}\StringTok{ }\DecValTok{6} \OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{, }\DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{), }\DecValTok{100}\NormalTok{),}
                       \DataTypeTok{dim =} \KeywordTok{c}\NormalTok{(}\DecValTok{2000000}\NormalTok{, }\DecValTok{6}\NormalTok{))}
\NormalTok{rle_matrix}
\CommentTok{#> RleMatrix object of 2000000 x 6 integers:}
\CommentTok{#>            [,1] [,2] [,3] [,4] [,5] [,6]}
\CommentTok{#>       [1,]    2    1    2    2    1    1}
\CommentTok{#>       [2,]    2    1    2    2    1    1}
\CommentTok{#>       [3,]    2    1    2    2    1    1}
\CommentTok{#>       [4,]    2    1    2    2    1    1}
\CommentTok{#>       [5,]    2    1    2    2    1    1}
\CommentTok{#>        ...    .    .    .    .    .    .}
\CommentTok{#> [1999996,]    1    1    1    1    1    2}
\CommentTok{#> [1999997,]    1    1    1    1    1    2}
\CommentTok{#> [1999998,]    1    1    1    1    1    2}
\CommentTok{#> [1999999,]    1    1    1    1    1    2}
\CommentTok{#> [2000000,]    1    1    1    1    1    2}
\end{Highlighting}
\end{Shaded}

Obviously, this is not a comprehensive set of inputs. Rather, it chosen
to be somewhat representative of some typical genomics data.

\section{Measuring performance}\label{measuring-performance}

Timings are measured using the
\emph{\href{https://CRAN.R-project.org/package=microbenchmark}{microbenchmark}}
package using 10 repetitions (\texttt{times}). Memory allocations are
reported using the
\emph{\href{https://CRAN.R-project.org/package=profmem}{profmem}}
package.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(microbenchmark)}
\KeywordTok{library}\NormalTok{(profmem)}
\NormalTok{times <-}\StringTok{ }\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\chapter{\texorpdfstring{\texttt{colSums2()}}{colSums2()}}\label{colsums2}

We compare the \texttt{DelayedArray::colSums()} method, which uses the
block-processing algorithm, to the
\texttt{DelayedMatrixStats::colSums2()} method, which uses tailored
algorithms depending on the \emph{seed} of the \emph{DelayedMatrix} and
to the \texttt{DelayedMatrixStats:::.colSums2()} method that acts
directly on the seed of the \emph{DelayedMatrix} object\footnote{\texttt{DelayedMatrixStats:::.colSums2()}
  shouldn't be called by the user because it does not realise delayed
  operations. It is used here for demonstration purposes on a
  ``\emph{pristine}'' DelayedMatrix to measure the additional overhead
  of S4 methods}

\section{\texorpdfstring{Pristine
\emph{DelayedMatrix}}{Pristine DelayedMatrix}}\label{pristine-delayedmatrix}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{:::}\KeywordTok{.colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(dense_matrix)),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                expr        min         lq}
\CommentTok{#>                 DelayedArray::colSums(dense_matrix) 1237.05967 1286.72366}
\CommentTok{#>          DelayedMatrixStats::colSums2(dense_matrix)   13.75110   14.48974}
\CommentTok{#>  DelayedMatrixStats:::.colSums2(seed(dense_matrix))   12.24977   12.52132}
\CommentTok{#>        mean     median         uq        max neval}
\CommentTok{#>  1338.77309 1313.47916 1425.51354 1472.51304    10}
\CommentTok{#>    15.43412   14.89400   16.46142   19.15365    10}
\CommentTok{#>    13.46753   12.83785   13.45714   17.22766    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix)))}
\CommentTok{#> [1] 2498171088}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix)))}
\CommentTok{#> [1] 165512}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{:::}\KeywordTok{.colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(sparse_matrix)),}
\NormalTok{               Matrix}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(}\KeywordTok{seed}\NormalTok{(sparse_matrix)), }
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                 expr         min}
\CommentTok{#>                 DelayedArray::colSums(sparse_matrix) 1263.948627}
\CommentTok{#>          DelayedMatrixStats::colSums2(sparse_matrix)   11.125717}
\CommentTok{#>  DelayedMatrixStats:::.colSums2(seed(sparse_matrix))    9.694688}
\CommentTok{#>                 Matrix::colSums(seed(sparse_matrix))    9.831111}
\CommentTok{#>           lq       mean     median         uq        max neval}
\CommentTok{#>  1277.792760 1354.97051 1345.26165 1409.33254 1478.01487    10}
\CommentTok{#>    11.321978   13.61341   12.38058   14.26526   24.21124    10}
\CommentTok{#>     9.737193   11.27165   10.42035   11.44131   15.96811    10}
\CommentTok{#>    10.428975   11.36380   10.85824   12.76856   13.00290    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix)))}
\CommentTok{#> [1] 1709267496}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix)))}
\CommentTok{#> [1] 5464}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{:::}\KeywordTok{.colSums2}\NormalTok{(}\KeywordTok{seed}\NormalTok{(rle_matrix)), }
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                              expr         min          lq}
\CommentTok{#>                 DelayedArray::colSums(rle_matrix) 2480.267737 2522.151174}
\CommentTok{#>          DelayedMatrixStats::colSums2(rle_matrix)    3.846588    4.031420}
\CommentTok{#>  DelayedMatrixStats:::.colSums2(seed(rle_matrix))    2.660000    2.794059}
\CommentTok{#>         mean      median          uq         max neval}
\CommentTok{#>  2564.381064 2555.504718 2616.171735 2646.783855    10}
\CommentTok{#>     4.632065    4.457076    4.814034    6.303599    10}
\CommentTok{#>     7.772226    3.021242    3.113427   50.727535    10}

\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix)))}
\CommentTok{#> [1] 787403608}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix)))}
\CommentTok{#> [1] 1872}
\end{Highlighting}
\end{Shaded}

\section{With row subsetting}\label{with-row-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dense_matrix), }\KeywordTok{nrow}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                  expr       min        lq}
\CommentTok{#>              DelayedArray::colSums(dense_matrix[i, ]) 150.12124 177.85944}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, rows = i)  14.09315  14.59356}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>  198.11233 192.73521 226.85481 240.19939    10}
\CommentTok{#>   15.12774  14.92626  15.38786  17.04865    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, ])))}
\CommentTok{#> [1] 326614368}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 21512}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                   expr      min       lq}
\CommentTok{#>              DelayedArray::colSums(sparse_matrix[i, ]) 181.0150 185.5543}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, rows = i)  43.4571  46.1228}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>  241.06562 214.46952 260.04889 403.65730    10}
\CommentTok{#>   47.23405  47.07576  48.33854  51.88142    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, ])))}
\CommentTok{#> [1] 217297184}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 5805384}

\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(rle_matrix), }\KeywordTok{nrow}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, ]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                expr       min       lq}
\CommentTok{#>              DelayedArray::colSums(rle_matrix[i, ])  266.4322  282.946}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, rows = i) 2509.9470 2536.812}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>   288.4523  285.5148  287.8931  342.1545    10}
\CommentTok{#>  2565.2083 2557.8006 2567.9954 2645.7166    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, ])))}
\CommentTok{#> [1] 86579640}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i)))}
\CommentTok{#> [1] 99980704}
\end{Highlighting}
\end{Shaded}

\section{With column subsetting}\label{with-column-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(dense_matrix), }\KeywordTok{ncol}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                  expr        min}
\CommentTok{#>              DelayedArray::colSums(dense_matrix[, j]) 130.822413}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, cols = j)   2.954383}
\CommentTok{#>          lq       mean     median         uq        max neval}
\CommentTok{#>  185.368641 192.741377 199.560679 204.350156 217.700374    10}
\CommentTok{#>    3.031592   3.534314   3.402916   3.717595   5.269981    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[, j])))}
\CommentTok{#> [1] 326835928}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 161192}

\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                   expr       min        lq}
\CommentTok{#>              DelayedArray::colSums(sparse_matrix[, j]) 145.41955 151.62413}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, cols = j)  12.24748  12.81168}
\CommentTok{#>       mean    median        uq      max neval}
\CommentTok{#>  187.63815 182.46718 222.64284 240.3814    10}
\CommentTok{#>   25.01388  14.35228  14.91043 124.2795    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[, j])))}
\CommentTok{#> [1] 217156704}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 5755072}

\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(rle_matrix), }\KeywordTok{ncol}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                expr         min         lq}
\CommentTok{#>              DelayedArray::colSums(rle_matrix[, j]) 1204.439061 1265.87484}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, cols = j)    3.645216    3.79055}
\CommentTok{#>        mean      median         uq         max neval}
\CommentTok{#>  1280.29217 1287.497136 1296.26175 1336.682742    10}
\CommentTok{#>     4.20517    4.107648    4.52946    4.896633    10}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[, j])))}
\CommentTok{#> [1] 401705608}
\KeywordTok{total}\NormalTok{(}\KeywordTok{profmem}\NormalTok{(DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{cols =}\NormalTok{ j)))}
\CommentTok{#> [1] 1872}
\end{Highlighting}
\end{Shaded}

\section{With row and column
subsetting}\label{with-row-and-column-subsetting}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dense_matrix), }\KeywordTok{nrow}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(dense_matrix), }\KeywordTok{ncol}\NormalTok{(dense_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                            expr       min}
\CommentTok{#>                       DelayedArray::colSums(dense_matrix[i, j]) 38.678242}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix, rows = i, cols = j)  2.471122}
\CommentTok{#>         lq      mean    median        uq        max neval}
\CommentTok{#>  40.658299 63.969289 67.446417 71.177195 103.697163    10}
\CommentTok{#>   2.514982  2.757317  2.719349  2.876589   3.446033    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                             expr      min}
\CommentTok{#>                       DelayedArray::colSums(sparse_matrix[i, j]) 58.16497}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix, rows = i, cols = j) 44.19810}
\CommentTok{#>        lq     mean   median       uq      max neval}
\CommentTok{#>  61.23579 72.97175 64.44056 68.37965 156.5290    10}
\CommentTok{#>  45.33201 47.71227 47.05405 50.12441  52.1516    10}
\NormalTok{i <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(rle_matrix), }\KeywordTok{nrow}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{j <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(rle_matrix), }\KeywordTok{ncol}\NormalTok{(rle_matrix) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{)}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix[i, j]),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix, }\DataTypeTok{rows =}\NormalTok{ i, }\DataTypeTok{cols =}\NormalTok{ j),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                                          expr       min}
\CommentTok{#>                       DelayedArray::colSums(rle_matrix[i, j])  144.6618}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix, rows = i, cols = j) 1227.4698}
\CommentTok{#>         lq      mean   median       uq       max neval}
\CommentTok{#>   146.4575  150.6922  147.420  148.844  179.0782    10}
\CommentTok{#>  1245.4921 1263.5119 1253.124 1269.115 1353.0914    10}
\end{Highlighting}
\end{Shaded}

\section{With delayed ops}\label{with-delayed-ops}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(dense_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(dense_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                          expr       min        lq}
\CommentTok{#>         DelayedArray::colSums(dense_matrix^2) 1326.8490 1431.4468}
\CommentTok{#>  DelayedMatrixStats::colSums2(dense_matrix^2)  246.0587  266.2838}
\CommentTok{#>       mean    median       uq       max neval}
\CommentTok{#>  1484.4255 1496.4808 1545.328 1591.2768    10}
\CommentTok{#>   302.2183  299.9772  310.943  413.7981    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(sparse_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(sparse_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: milliseconds}
\CommentTok{#>                                           expr       min        lq}
\CommentTok{#>         DelayedArray::colSums(sparse_matrix^2) 1368.0792 1402.4556}
\CommentTok{#>  DelayedMatrixStats::colSums2(sparse_matrix^2)  531.5231  567.5002}
\CommentTok{#>       mean    median        uq       max neval}
\CommentTok{#>  1486.7550 1466.0952 1545.2155 1652.8075    10}
\CommentTok{#>   582.7944  587.3182  602.8364  621.8481    10}
\KeywordTok{microbenchmark}\NormalTok{(DelayedArray}\OperatorTok{::}\KeywordTok{colSums}\NormalTok{(rle_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
\NormalTok{               DelayedMatrixStats}\OperatorTok{::}\KeywordTok{colSums2}\NormalTok{(rle_matrix }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{),}
               \DataTypeTok{times =}\NormalTok{ times)}
\CommentTok{#> Unit: seconds}
\CommentTok{#>                                        expr      min       lq     mean}
\CommentTok{#>         DelayedArray::colSums(rle_matrix^2) 2.617288 2.673016 2.765875}
\CommentTok{#>  DelayedMatrixStats::colSums2(rle_matrix^2) 2.330117 2.380350 2.441969}
\CommentTok{#>    median       uq      max neval}
\CommentTok{#>  2.715906 2.887769 2.987700    10}
\CommentTok{#>  2.418112 2.530877 2.547293    10}
\end{Highlighting}
\end{Shaded}

\section{Summary}\label{summary}

\bibliography{packages.bib,book.bib}


\end{document}
