<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Benchmarking the DelayedMatrixStats package</title>
  <meta name="description" content="Benchmarking of the DelayedMatrixStats package">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Benchmarking the DelayedMatrixStats package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Benchmarking of the DelayedMatrixStats package" />
  <meta name="github-repo" content="PeteHaitch/DelayedMatrixStatsBenchmarking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Benchmarking the DelayedMatrixStats package" />
  
  <meta name="twitter:description" content="Benchmarking of the DelayedMatrixStats package" />
  

<meta name="author" content="Peter Hickey">


<meta name="date" content="2017-06-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="test-data.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Benchmarking DelayedMatrixStats</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i><b>1.1</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="test-data.html"><a href="test-data.html"><i class="fa fa-check"></i><b>2</b> Test data</a><ul>
<li class="chapter" data-level="2.1" data-path="test-data.html"><a href="test-data.html#measuring-performance"><i class="fa fa-check"></i><b>2.1</b> Measuring performance</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="colsums2.html"><a href="colsums2.html"><i class="fa fa-check"></i><b>3</b> <code>colSums2()</code></a><ul>
<li class="chapter" data-level="3.1" data-path="colsums2.html"><a href="colsums2.html#pristine-delayedmatrix"><i class="fa fa-check"></i><b>3.1</b> Pristine <em>DelayedMatrix</em></a></li>
<li class="chapter" data-level="3.2" data-path="colsums2.html"><a href="colsums2.html#with-row-subsetting"><i class="fa fa-check"></i><b>3.2</b> With row subsetting</a></li>
<li class="chapter" data-level="3.3" data-path="colsums2.html"><a href="colsums2.html#with-column-subsetting"><i class="fa fa-check"></i><b>3.3</b> With column subsetting</a></li>
<li class="chapter" data-level="3.4" data-path="colsums2.html"><a href="colsums2.html#with-row-and-column-subsetting"><i class="fa fa-check"></i><b>3.4</b> With row and column subsetting</a></li>
<li class="chapter" data-level="3.5" data-path="colsums2.html"><a href="colsums2.html#with-delayed-ops"><i class="fa fa-check"></i><b>3.5</b> With delayed ops</a></li>
<li class="chapter" data-level="3.6" data-path="colsums2.html"><a href="colsums2.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Benchmarking the DelayedMatrixStats package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="colsums2" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> <code>colSums2()</code></h1>
<p>We compare the <code>DelayedArray::colSums()</code> method, which uses the block-processing algorithm, to the <code>DelayedMatrixStats::colSums2()</code> method, which uses tailored algorithms depending on the <em>seed</em> of the <em>DelayedMatrix</em> and to the <code>DelayedMatrixStats:::.colSums2()</code> method that acts directly on the seed of the <em>DelayedMatrix</em> object<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<div id="pristine-delayedmatrix" class="section level2">
<h2><span class="header-section-number">3.1</span> Pristine <em>DelayedMatrix</em></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix),
               DelayedMatrixStats<span class="op">:::</span><span class="kw">.colSums2</span>(<span class="kw">seed</span>(dense_matrix)),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                expr        min         lq</span>
<span class="co">#&gt;                 DelayedArray::colSums(dense_matrix) 1408.61567 1433.98258</span>
<span class="co">#&gt;          DelayedMatrixStats::colSums2(dense_matrix)   14.00580   14.50890</span>
<span class="co">#&gt;  DelayedMatrixStats:::.colSums2(seed(dense_matrix))   12.75963   13.24246</span>
<span class="co">#&gt;        mean     median         uq        max neval</span>
<span class="co">#&gt;  1515.04624 1468.59992 1550.81586 1877.00361    10</span>
<span class="co">#&gt;    15.66976   15.05065   15.16516   19.91145    10</span>
<span class="co">#&gt;    14.41188   14.03868   15.12447   16.97410    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix)))
<span class="co">#&gt; [1] 2498171088</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix)))
<span class="co">#&gt; [1] 165512</span>

<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix),
               DelayedMatrixStats<span class="op">:::</span><span class="kw">.colSums2</span>(<span class="kw">seed</span>(sparse_matrix)),
               Matrix<span class="op">::</span><span class="kw">colSums</span>(<span class="kw">seed</span>(sparse_matrix)), 
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                 expr         min</span>
<span class="co">#&gt;                 DelayedArray::colSums(sparse_matrix) 1183.847176</span>
<span class="co">#&gt;          DelayedMatrixStats::colSums2(sparse_matrix)   11.184205</span>
<span class="co">#&gt;  DelayedMatrixStats:::.colSums2(seed(sparse_matrix))    9.793739</span>
<span class="co">#&gt;                 Matrix::colSums(seed(sparse_matrix))    9.850097</span>
<span class="co">#&gt;          lq       mean     median         uq        max neval</span>
<span class="co">#&gt;  1203.56868 1263.47204 1246.03850 1327.38476 1385.78481    10</span>
<span class="co">#&gt;    11.27018   13.03639   13.27612   14.54941   15.45832    10</span>
<span class="co">#&gt;    10.94256   11.56462   11.36510   11.94394   13.74808    10</span>
<span class="co">#&gt;    10.12159   10.98836   10.55925   12.14756   12.72709    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix)))
<span class="co">#&gt; [1] 1709267504</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix)))
<span class="co">#&gt; [1] 5464</span>

<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix),
               DelayedMatrixStats<span class="op">:::</span><span class="kw">.colSums2</span>(<span class="kw">seed</span>(rle_matrix)), 
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                              expr         min          lq</span>
<span class="co">#&gt;                 DelayedArray::colSums(rle_matrix) 2403.753261 2447.157148</span>
<span class="co">#&gt;          DelayedMatrixStats::colSums2(rle_matrix)    3.753334    3.767261</span>
<span class="co">#&gt;  DelayedMatrixStats:::.colSums2(seed(rle_matrix))    2.697623    2.723950</span>
<span class="co">#&gt;         mean      median          uq         max neval</span>
<span class="co">#&gt;  2502.838647 2480.543781 2563.364811 2631.490872    10</span>
<span class="co">#&gt;     3.986795    3.938854    3.988843    4.708529    10</span>
<span class="co">#&gt;     8.197613    2.914385    3.718004   46.153767    10</span>

<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix)))
<span class="co">#&gt; [1] 787412248</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix)))
<span class="co">#&gt; [1] 1872</span></code></pre></div>
</div>
<div id="with-row-subsetting" class="section level2">
<h2><span class="header-section-number">3.2</span> With row subsetting</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(dense_matrix), <span class="kw">nrow</span>(dense_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix[i, ]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix, <span class="dt">rows =</span> i),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                  expr       min        lq</span>
<span class="co">#&gt;              DelayedArray::colSums(dense_matrix[i, ]) 187.48875 192.80726</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(dense_matrix, rows = i)  13.49945  13.76257</span>
<span class="co">#&gt;       mean    median        uq       max neval</span>
<span class="co">#&gt;  226.72987 195.30400 231.85423 348.03247    10</span>
<span class="co">#&gt;   14.20651  14.08922  14.45145  15.72646    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix[i, ])))
<span class="co">#&gt; [1] 326614368</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix, <span class="dt">rows =</span> i)))
<span class="co">#&gt; [1] 21512</span>

<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix[i, ]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix, <span class="dt">rows =</span> i),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                   expr       min        lq</span>
<span class="co">#&gt;              DelayedArray::colSums(sparse_matrix[i, ]) 188.74200 193.95678</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(sparse_matrix, rows = i)  44.11033  44.67383</span>
<span class="co">#&gt;       mean    median        uq       max neval</span>
<span class="co">#&gt;  207.15558 208.61591 219.32978 227.67523    10</span>
<span class="co">#&gt;   48.45741  47.51677  48.57594  58.05766    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix[i, ])))
<span class="co">#&gt; [1] 217286848</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix, <span class="dt">rows =</span> i)))
<span class="co">#&gt; [1] 5795040</span>

i &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(rle_matrix), <span class="kw">nrow</span>(rle_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix[i, ]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix, <span class="dt">rows =</span> i),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                expr       min        lq</span>
<span class="co">#&gt;              DelayedArray::colSums(rle_matrix[i, ])  265.1415  281.9165</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(rle_matrix, rows = i) 2521.6969 2530.8499</span>
<span class="co">#&gt;       mean    median        uq      max neval</span>
<span class="co">#&gt;   295.5994  288.7689  318.6109  329.836    10</span>
<span class="co">#&gt;  2564.1160 2556.6985 2575.4062 2685.863    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix[i, ])))
<span class="co">#&gt; [1] 86581048</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix, <span class="dt">rows =</span> i)))
<span class="co">#&gt; [1] 99980704</span></code></pre></div>
</div>
<div id="with-column-subsetting" class="section level2">
<h2><span class="header-section-number">3.3</span> With column subsetting</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">j &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">ncol</span>(dense_matrix), <span class="kw">ncol</span>(dense_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix[, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                  expr        min</span>
<span class="co">#&gt;              DelayedArray::colSums(dense_matrix[, j]) 160.602091</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(dense_matrix, cols = j)   2.846538</span>
<span class="co">#&gt;          lq       mean     median         uq        max neval</span>
<span class="co">#&gt;  163.752830 189.342436 165.306212 204.669825 327.949654    10</span>
<span class="co">#&gt;    3.031495   3.212337   3.124543   3.189582   4.017612    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix[, j])))
<span class="co">#&gt; [1] 326835928</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix, <span class="dt">cols =</span> j)))
<span class="co">#&gt; [1] 161192</span>

<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix[, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                   expr       min        lq</span>
<span class="co">#&gt;              DelayedArray::colSums(sparse_matrix[, j]) 162.11769 174.45367</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(sparse_matrix, cols = j)  10.76092  12.58258</span>
<span class="co">#&gt;       mean    median        uq       max neval</span>
<span class="co">#&gt;  197.77123 178.79578 203.35623 328.86511    10</span>
<span class="co">#&gt;   13.34045  13.34616  14.48577  14.64604    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix[, j])))
<span class="co">#&gt; [1] 217160744</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix, <span class="dt">cols =</span> j)))
<span class="co">#&gt; [1] 5759104</span>

j &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">ncol</span>(rle_matrix), <span class="kw">ncol</span>(rle_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix[, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                expr        min          lq</span>
<span class="co">#&gt;              DelayedArray::colSums(rle_matrix[, j]) 1206.04993 1229.242478</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(rle_matrix, cols = j)    3.56065    3.856014</span>
<span class="co">#&gt;         mean     median         uq         max neval</span>
<span class="co">#&gt;  1254.683014 1250.18800 1277.53525 1317.428964    10</span>
<span class="co">#&gt;     3.956366    3.93841    4.16998    4.431168    10</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix[, j])))
<span class="co">#&gt; [1] 401708120</span>
<span class="kw">total</span>(<span class="kw">profmem</span>(DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix, <span class="dt">cols =</span> j)))
<span class="co">#&gt; [1] 1872</span></code></pre></div>
</div>
<div id="with-row-and-column-subsetting" class="section level2">
<h2><span class="header-section-number">3.4</span> With row and column subsetting</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(dense_matrix), <span class="kw">nrow</span>(dense_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
j &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">ncol</span>(dense_matrix), <span class="kw">ncol</span>(dense_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix[i, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix, <span class="dt">rows =</span> i, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                            expr      min</span>
<span class="co">#&gt;                       DelayedArray::colSums(dense_matrix[i, j]) 38.16495</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(dense_matrix, rows = i, cols = j)  2.45432</span>
<span class="co">#&gt;         lq     mean    median        uq        max neval</span>
<span class="co">#&gt;  42.814124 71.53257 62.697789 68.861067 210.056720    10</span>
<span class="co">#&gt;   2.504864  2.79146  2.552467  2.703125   4.614551    10</span>
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix[i, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix, <span class="dt">rows =</span> i, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                             expr      min</span>
<span class="co">#&gt;                       DelayedArray::colSums(sparse_matrix[i, j]) 46.49547</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(sparse_matrix, rows = i, cols = j) 42.05782</span>
<span class="co">#&gt;        lq     mean   median       uq       max neval</span>
<span class="co">#&gt;  61.82952 62.85905 63.41717 65.98138  85.79071    10</span>
<span class="co">#&gt;  44.16492 53.69229 46.26637 48.85194 119.13561    10</span>
i &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(rle_matrix), <span class="kw">nrow</span>(rle_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>)
j &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">ncol</span>(rle_matrix), <span class="kw">ncol</span>(rle_matrix) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix[i, j]),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix, <span class="dt">rows =</span> i, <span class="dt">cols =</span> j),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                                          expr       min</span>
<span class="co">#&gt;                       DelayedArray::colSums(rle_matrix[i, j])  145.6185</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(rle_matrix, rows = i, cols = j) 1255.3213</span>
<span class="co">#&gt;         lq      mean    median        uq       max neval</span>
<span class="co">#&gt;   149.0024  158.6695  150.1652  179.6876  184.4764    10</span>
<span class="co">#&gt;  1268.5583 1287.6573 1286.5773 1302.5283 1331.8413    10</span></code></pre></div>
</div>
<div id="with-delayed-ops" class="section level2">
<h2><span class="header-section-number">3.5</span> With delayed ops</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(dense_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(dense_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                          expr       min        lq</span>
<span class="co">#&gt;         DelayedArray::colSums(dense_matrix^2) 1316.7381 1442.1117</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(dense_matrix^2)  266.3058  280.9153</span>
<span class="co">#&gt;       mean    median        uq       max neval</span>
<span class="co">#&gt;  1459.9733 1474.6550 1496.8039 1587.6119    10</span>
<span class="co">#&gt;   387.4722  417.6813  447.7697  472.5307    10</span>
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(sparse_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(sparse_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;                                           expr       min       lq</span>
<span class="co">#&gt;         DelayedArray::colSums(sparse_matrix^2) 1264.0716 1363.074</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(sparse_matrix^2)  529.0654  542.983</span>
<span class="co">#&gt;       mean    median        uq       max neval</span>
<span class="co">#&gt;  1478.3990 1456.5185 1578.1508 1769.6818    10</span>
<span class="co">#&gt;   578.2613  550.6886  646.3959  656.6858    10</span>
<span class="kw">microbenchmark</span>(DelayedArray<span class="op">::</span><span class="kw">colSums</span>(rle_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               DelayedMatrixStats<span class="op">::</span><span class="kw">colSums2</span>(rle_matrix <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
               <span class="dt">times =</span> times)
<span class="co">#&gt; Unit: seconds</span>
<span class="co">#&gt;                                        expr      min       lq     mean</span>
<span class="co">#&gt;         DelayedArray::colSums(rle_matrix^2) 2.666107 2.673326 2.766047</span>
<span class="co">#&gt;  DelayedMatrixStats::colSums2(rle_matrix^2) 2.321411 2.408761 2.498563</span>
<span class="co">#&gt;    median       uq      max neval</span>
<span class="co">#&gt;  2.724920 2.838986 2.970594    10</span>
<span class="co">#&gt;  2.514786 2.579666 2.658754    10</span></code></pre></div>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">3.6</span> Summary</h2>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p><code>DelayedMatrixStats:::.colSums2()</code> shouldn’t be called by the user because it does not realise delayed operations. It is used here for demonstration purposes on a “<em>pristine</em>” DelayedMatrix to measure the additional overhead of S4 methods<a href="colsums2.html#fnref1">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="test-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/PeteHaitch/BenchmarkingDelayedMatrixStats/edit/master/02_colSums2.Rmd",
"text": "Edit"
},
"download": ["BenchmarkingDelayedMatrixStats.pdf", "BenchmarkingDelayedMatrixStats.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
